(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{506:function(t,e,a){"use strict";a.r(e);var n=a(33),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"custom-commands"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-commands"}},[t._v("#")]),t._v(" Custom Commands")]),t._v(" "),a("p",[t._v("Command represents a single operation, that controls what happens on the scene; e.g., it can be used to change a background, move a character or load another naninovel script. Parametrized command sequences defined in "),a("RouterLink",{attrs:{to:"/zh/guide/naninovel-scripts.html"}},[t._v("naninovel scripts")]),t._v(" effectively controls the game flow. You can find available built-in commands in the "),a("RouterLink",{attrs:{to:"/zh/api/"}},[t._v("API reference")]),t._v(". In code, all the built-in script command implementations are defined under "),a("code",[t._v("Naninovel.Commands")]),t._v(" namespace.")],1),t._v(" "),a("h2",{attrs:{id:"adding-custom-command"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-custom-command"}},[t._v("#")]),t._v(" Adding Custom Command")]),t._v(" "),a("p",[t._v("To add your own custom script command, create a new C# class derived from "),a("code",[t._v("Command")]),t._v(" and implement "),a("code",[t._v("ExecuteAsync")]),t._v(" abstract method. The created class will automatically be picked up by the engine and you'll be able to invoke the command from the naninovel scripts by either the class name or an alias (if assigned). To assign an alias to the naninovel command, apply "),a("code",[t._v("CommandAlias")]),t._v(" attribute to the class.")]),t._v(" "),a("p",[a("code",[t._v("ExecuteAsync")]),t._v(" is an async method invoked when the command is executed by the scripts player; put the command logic there. Use "),a("RouterLink",{attrs:{to:"/zh/guide/engine-services.html"}},[t._v("engine services")]),t._v(" to access the engine built-in systems. Naninovel script execution will halt until this method returns a completed task in case "),a("code",[t._v("Wait")]),t._v(" parameter is "),a("code",[t._v("true")]),t._v(".")],1),t._v(" "),a("p",[t._v("To expose a command parameter to naninovel scripts, add a public field to the command class with one of the supported types:")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Field Type")]),t._v(" "),a("th",[t._v("Value Type")]),t._v(" "),a("th",[t._v("Script Example")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("StringParameter")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[a("code",[t._v("LoremIpsum")]),t._v(", "),a("code",[t._v('"Lorem ipsum"')])])]),t._v(" "),a("tr",[a("td",[t._v("IntegerParameter")]),t._v(" "),a("td",[t._v("Int32")]),t._v(" "),a("td",[a("code",[t._v("10")]),t._v(", "),a("code",[t._v("0")]),t._v(", "),a("code",[t._v("-1")])])]),t._v(" "),a("tr",[a("td",[t._v("DecimalParameter")]),t._v(" "),a("td",[t._v("Single")]),t._v(" "),a("td",[a("code",[t._v("0.525")]),t._v(", "),a("code",[t._v("-55.1")])])]),t._v(" "),a("tr",[a("td",[t._v("BooleanParameter")]),t._v(" "),a("td",[t._v("Boolean")]),t._v(" "),a("td",[a("code",[t._v("true")]),t._v(", "),a("code",[t._v("false")])])]),t._v(" "),a("tr",[a("td",[t._v("NamedStringParameter")]),t._v(" "),a("td",[t._v("NamedString")]),t._v(" "),a("td",[a("code",[t._v("Script001.LabelName")]),t._v(", "),a("code",[t._v(".LabelName")])])]),t._v(" "),a("tr",[a("td",[t._v("NamedIntegerParameter")]),t._v(" "),a("td",[t._v("NamedInteger")]),t._v(" "),a("td",[a("code",[t._v("Yuko.5")])])]),t._v(" "),a("tr",[a("td",[t._v("NamedDecimalParameter")]),t._v(" "),a("td",[t._v("NamedFloat")]),t._v(" "),a("td",[a("code",[t._v("Kohaku.-10.25")])])]),t._v(" "),a("tr",[a("td",[t._v("NamedBooleanParameter")]),t._v(" "),a("td",[t._v("NamedBoolean")]),t._v(" "),a("td",[a("code",[t._v("Misaki.false")])])]),t._v(" "),a("tr",[a("td",[t._v("StringListParameter")]),t._v(" "),a("td",[t._v("List<String>")]),t._v(" "),a("td",[a("code",[t._v('Lorem,ipsum,"doler sit amet"')])])]),t._v(" "),a("tr",[a("td",[t._v("IntegerListParameter")]),t._v(" "),a("td",[t._v("List<Int32>")]),t._v(" "),a("td",[a("code",[t._v("10,-1,0")])])]),t._v(" "),a("tr",[a("td",[t._v("DecimalListParameter")]),t._v(" "),a("td",[t._v("List<Single>")]),t._v(" "),a("td",[a("code",[t._v("0.2,10.5,-88.99")])])]),t._v(" "),a("tr",[a("td",[t._v("BooleanListParameter")]),t._v(" "),a("td",[t._v("List<Boolean>")]),t._v(" "),a("td",[a("code",[t._v("true,false,true")])])]),t._v(" "),a("tr",[a("td",[t._v("NamedStringListParameter")]),t._v(" "),a("td",[t._v("List<NamedString>")]),t._v(" "),a("td",[a("code",[t._v("Felix.Happy,Jenna.Confidence")])])]),t._v(" "),a("tr",[a("td",[t._v("NamedIntegerListParameter")]),t._v(" "),a("td",[t._v("List<NamedInteger>")]),t._v(" "),a("td",[a("code",[t._v("Yuko.5,Misaki.-8")])])]),t._v(" "),a("tr",[a("td",[t._v("NamedDecimalListParameter")]),t._v(" "),a("td",[t._v("List<NamedFloat>")]),t._v(" "),a("td",[a("code",[t._v("Nanikun.88.99,Yuko.-5.1")])])]),t._v(" "),a("tr",[a("td",[t._v("NamedBooleanListParameter")]),t._v(" "),a("td",[t._v("List<NamedBoolean>")]),t._v(" "),a("td",[a("code",[t._v("Misaki.false,Kohaku.true")])])])])]),t._v(" "),a("p",[t._v("Optionally, you can apply "),a("code",[t._v("[ParameterAlias]")]),t._v(" attribute to the field to assign an alias name to the parameter allowing it to be used instead of the field name when referencing the parameter in naninovel scripts. If you wish to make the parameter nameless, set "),a("code",[t._v("Command.NamelessParameterAlias")]),t._v(" constant (empty string) as the alias; please note, that only one nameless parameter is allowed per command.")]),t._v(" "),a("p",[t._v("To make parameter required (causing an error to be logged when it's not specified in naninovel script), apply "),a("code",[t._v("[RequiredParameter]")]),t._v(" attribute to the field. When the attribute is not applied, parameter is considered optional.")]),t._v(" "),a("p",[t._v("All the parameter types have "),a("code",[t._v("HasValue")]),t._v(" property, which you can use to test whether the parameter has been assigned in naninovel script; optionally, you can use "),a("code",[t._v("Command.Assigned()")]),t._v(" static method, which takes a parameter instance and returns true when the provided parameter is not null and has a value assigned.")]),t._v(" "),a("p",[t._v("In case execution of the command requires loading some resources, implement "),a("code",[t._v("Command.IPreloadable")]),t._v(" interface to preload the required resources when the game is loading.")]),t._v(" "),a("p",[t._v("In case the command have parameters that can be localized (text directly presented to the user, usually), implement "),a("code",[t._v("Command.ILocalizable")]),t._v(" interface to add the command to the generated script localization documents.")]),t._v(" "),a("p",[t._v("You can find scripts with all the built-in command implementations at "),a("code",[t._v("Naninovel/Runtime/Commands")]),t._v(" package folder; feel free to use them as a reference when implementing your own custom commands.")]),t._v(" "),a("p",[t._v("Here is an example of a custom command, that can be invoked from naninovel scripts as "),a("code",[t._v("@HelloWorld")]),t._v(" or "),a("code",[t._v("@hello")]),t._v(" to print "),a("code",[t._v("Hello World!")]),t._v(" to the console and can also take an optional "),a("code",[t._v("name")]),t._v(" parameter (eg, "),a("code",[t._v("@hello name:Felix")]),t._v(") to greet the provided name instead of the world:")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("Naninovel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Commands")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Threading")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("UniRx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Async")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("UnityEngine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommandAlias")]),a("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HelloWorld")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Command")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringParameter")]),t._v(" Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("UniTask")]),t._v(" ExecuteAsync "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CancellationToken")]),t._v(" cancellationToken "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Assigned")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            Debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('$"Hello, ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token expression language-csharp"}},[t._v("Name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('!"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            Debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" UniTask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CompletedTask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Notice the optional "),a("code",[t._v("CancellationToken")]),t._v(" argument. In case invoking any async methods, make sure to check the token for cancellation requests and return ASAP.")]),t._v(" "),a("div",{staticClass:"custom-block example"},[a("p",{staticClass:"custom-block-title"},[t._v("例")]),t._v(" "),a("p",[t._v("Another example of adding custom commands to add/remove items of an inventory system can be found in the "),a("a",{attrs:{href:"https://github.com/Elringus/NaninovelInventory",target:"_blank",rel:"noopener noreferrer"}},[t._v("inventory example project on GitHub"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("Specifically, the command implementations are stored at "),a("a",{attrs:{href:"https://github.com/Elringus/NaninovelInventory/tree/master/Assets/NaninovelInventory/Runtime/Commands",target:"_blank",rel:"noopener noreferrer"}},[t._v("Runtime/Commands"),a("OutboundLink")],1),t._v(" directory.")])]),t._v(" "),a("h2",{attrs:{id:"ide-metadata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ide-metadata"}},[t._v("#")]),t._v(" IDE Metadata")]),t._v(" "),a("p",[t._v("When adding custom commands, you may notice that they're highlighted as errors in "),a("RouterLink",{attrs:{to:"/zh/guide/naninovel-scripts.html#ide-support"}},[t._v("IDE extensions")]),t._v(". That is due to metadata of the custom commands is not available to the extensions. You can use custom commands tool to automatically generate the required metadata file over all the custom commands present in the project.")],1),t._v(" "),a("p",[t._v("Open the tool with "),a("code",[t._v("Naninovel -> Tools -> Custom Commands")]),t._v(' editor menu, then click "Select" button and select path to '),a("code",[t._v("server")]),t._v(" folder found inside the target IDE extension; eg, for Atom it'll be "),a("code",[t._v("%HOMEPATH%/.atom/packages/language-naniscript/server")]),t._v(", where "),a("code",[t._v("%HOMEPATH%")]),t._v(' is the path to your OS user directory. Click "Generate Custom Commands Metadata" button to generate the file at the specified path and restart IDE for changes to take effect. The custom commands should now be recognized by the IDE. When you add or modify the commands, repeat the process to update metadata file of the target extension.')]),t._v(" "),a("div",{staticClass:"custom-block warn"},[a("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),a("p",[t._v("Implementing types of the custom commands should not be under "),a("code",[t._v("Naninovel.Commands")]),t._v(" "),a("a",{attrs:{href:"https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/namespaces/",target:"_blank",rel:"noopener noreferrer"}},[t._v("namespace"),a("OutboundLink")],1),t._v("; otherwise, they will be recognized as built-in commands and won't be included in the generated metadata file.")])]),t._v(" "),a("p",[t._v("If you'd like to add documentation to the custom commands and/or parameters, apply "),a("code",[t._v("Documentation")]),t._v(" attribute to command type and parameter fields respectively:")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Summary of the custom command."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomCommand")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Command")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Summary of the custom parameter."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringParameter")]),t._v(" CustomParameter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Below you can find a video tutorial on how to generate metadata of custom commands (via "),a("a",{attrs:{href:"https://github.com/Elringus/NaninovelInventory",target:"_blank",rel:"noopener noreferrer"}},[t._v("inventory example project"),a("OutboundLink")],1),t._v(") for Atom IDE extension.")]),t._v(" "),a("p"),a("div",{staticClass:"video-container"},[a("iframe",{attrs:{src:"https://www.youtube-nocookie.com/embed/Fg-esrR-0mU",frameborder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}})]),a("p")])}),[],!1,null,null,null);e.default=s.exports}}]);